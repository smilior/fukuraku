name: Daily X Post Reminder

on:
  schedule:
    # æ¯æœ9æ™‚(JST) = UTC 0æ™‚ã«å®Ÿè¡Œ
    - cron: "0 0 * * *"
  workflow_dispatch: # æ‰‹å‹•å®Ÿè¡Œã‚‚å¯èƒ½

jobs:
  create-post-reminder:
    name: Create X Post Reminder Issue
    runs-on: ubuntu-latest
    timeout-minutes: 5
    permissions:
      issues: write
      contents: read

    steps:
      - uses: actions/checkout@v4

      - name: Pick random post and create issue
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # post-templates.md ã‹ã‚‰ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ–ãƒ­ãƒƒã‚¯ã‚’ãƒ©ãƒ³ãƒ€ãƒ é¸æŠ
          TEMPLATES_FILE="docs/marketing/x/post-templates.md"

          if [ ! -f "$TEMPLATES_FILE" ]; then
            echo "Post templates file not found"
            exit 1
          fi

          # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç•ªå·ã®ä¸€è¦§ã‚’å–å¾—ï¼ˆ### ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆN ã®è¡Œã‚’æŠ½å‡ºï¼‰
          TEMPLATE_NUMBERS=$(grep -n "^### ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ" "$TEMPLATES_FILE" | cut -d: -f1)
          TEMPLATE_COUNT=$(echo "$TEMPLATE_NUMBERS" | wc -l | tr -d ' ')

          if [ "$TEMPLATE_COUNT" -eq 0 ]; then
            echo "No templates found"
            exit 1
          fi

          # ãƒ©ãƒ³ãƒ€ãƒ ã«1ã¤é¸æŠ
          RANDOM_INDEX=$(( RANDOM % TEMPLATE_COUNT + 1 ))
          START_LINE=$(echo "$TEMPLATE_NUMBERS" | sed -n "${RANDOM_INDEX}p")

          # æ¬¡ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®é–‹å§‹è¡Œã¾ãŸã¯æ¬¡ã® ## ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®é–‹å§‹è¡Œã‚’æ¢ã™
          NEXT_SECTION=$(tail -n +"$((START_LINE + 1))" "$TEMPLATES_FILE" | grep -n "^### ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ\|^## ã‚«ãƒ†ã‚´ãƒª\|^---$" | head -1 | cut -d: -f1)

          if [ -z "$NEXT_SECTION" ]; then
            # ãƒ•ã‚¡ã‚¤ãƒ«ã®æœ«å°¾ã¾ã§
            POST_CONTENT=$(tail -n +"$START_LINE" "$TEMPLATES_FILE")
          else
            END_LINE=$((START_LINE + NEXT_SECTION - 1))
            POST_CONTENT=$(sed -n "${START_LINE},${END_LINE}p" "$TEMPLATES_FILE")
          fi

          # æ—¥ä»˜ã‚’å–å¾—
          TODAY=$(TZ=Asia/Tokyo date +%Y-%m-%d)
          DAY_OF_WEEK=$(TZ=Asia/Tokyo date +%A)

          # GitHub Issueã‚’ä½œæˆ
          gh issue create \
            --title "ğŸ“± ä»Šæ—¥ã®Xãƒã‚¹ãƒˆæ¡ˆ ${TODAY}" \
            --label "marketing" \
            --body "## ä»Šæ—¥ã®æŠ•ç¨¿æ¡ˆï¼ˆ${TODAY} ${DAY_OF_WEEK}ï¼‰

ä»¥ä¸‹ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’å‚è€ƒã«ã€ä»Šæ—¥ã®XæŠ•ç¨¿ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

${POST_CONTENT}

---

### æŠ•ç¨¿ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
- [ ] æŠ•ç¨¿å†…å®¹ã‚’ç¢ºèªãƒ»ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º
- [ ] ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ã‚’ç¢ºèªï¼ˆ1ã€œ2å€‹ã¾ã§ï¼‰
- [ ] ç”»åƒã‚„ã‚¹ãƒ¬ãƒƒãƒ‰ã®æº–å‚™ï¼ˆä»»æ„ï¼‰
- [ ] æŠ•ç¨¿å®Œäº†

### å‚è€ƒ
- [æŠ•ç¨¿ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼](docs/marketing/x/content-calendar.md)
- [ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°æˆ¦ç•¥](docs/marketing/x/hashtag-strategy.md)
- [å…¨ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ](docs/marketing/x/post-templates.md)"
