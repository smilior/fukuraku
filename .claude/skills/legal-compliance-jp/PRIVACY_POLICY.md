# プライバシーポリシーテンプレート

## 個人情報保護法（APPI）への対応

2022年4月施行の改正個人情報保護法（APPI）に対応する必要があります。

**主な対応項目：**
- 個人情報の利用目的の特定と通知
- 第三者提供の同意取得
- 安全管理措置の実施
- 本人からの開示・訂正・削除請求への対応
- 漏えい等が発生した場合の個人情報保護委員会への報告義務（1,000人超）
- 外国にある第三者への提供に関する情報提供

---

## 収集する個人情報の種類

**直接収集する情報：**
- メールアドレス（アカウント登録）
- 氏名（任意入力）
- パスワード（ハッシュ化して保存）
- 副業収入データ（ユーザーが入力）
- 経費データ（ユーザーが入力）
- レシート・領収書の画像（ユーザーがアップロード）

**自動的に収集する情報：**
- アクセスログ（IPアドレス、アクセス日時）
- デバイス情報（ブラウザ種類、OS、画面サイズ）
- Cookie情報（セッション管理、GA4）
- サービスの利用状況（ページ遷移、機能使用状況）

**第三者から取得する情報：**
- Google OAuth 認証情報（メールアドレス、プロフィール画像）

---

## 利用目的

- 本サービスの提供・運営
- レシート画像のOCR読取りおよび経費の自動分類
- 副業所得の集計および確定申告要否の判定
- ユーザーからのお問い合わせへの対応
- サービスの改善・新機能の開発
- 利用状況の分析（アクセス解析）
- 有料プランの課金処理
- 重要なお知らせ・規約変更の通知
- 不正利用の検知・防止

---

## 第三者提供先

**業務委託先・連携サービス一覧：**

| サービス名 | 用途 | 提供する情報 | 所在地 |
|-----------|------|------------|--------|
| Supabase | データベース・認証 | アカウント情報、利用データ | 東京リージョン（ap-northeast-1） |
| Stripe | 決済処理 | メールアドレス、カード情報（Stripeが直接取得） | 米国 |
| OpenAI | AI分析（レシートOCR等） | レシート画像、テキストデータ | 米国 |
| Vercel | ホスティング | アクセスログ | 米国（CDN: 東京エッジ） |
| Google Analytics 4 | アクセス解析 | Cookie、アクセスログ | 米国 |
| Resend | メール送信 | メールアドレス | 米国 |

**重要：外国にある第三者への提供について**
改正APPIでは、外国にある第三者に個人データを提供する場合、
その国の個人情報保護制度について情報提供する義務があります。

---

## データの保管・保持期間

- ユーザーデータ：アカウント削除後30日以内に完全削除
- レシート画像：アップロード後、OCR処理完了から90日後に自動削除（設定変更可）
- アクセスログ：取得から1年間保持後、自動削除
- 決済記録：法令に基づき7年間保持（電子帳簿保存法対応）
- バックアップデータ：バックアップ作成から90日後に自動削除

---

## 副楽向けプライバシーポリシーひな形

```
プライバシーポリシー

最終更新日：20XX年XX月XX日

[運営者名]（以下「当社」といいます。）は、副業確定申告支援サービス「副楽」
（以下「本サービス」といいます。）における個人情報の取扱いについて、以下のとおり
プライバシーポリシー（以下「本ポリシー」といいます。）を定めます。

1. 収集する個人情報
当社は、本サービスの提供にあたり、以下の個人情報を収集します。

(1) ユーザーが提供する情報
  - メールアドレス（アカウント登録時）
  - 氏名（任意）
  - 副業に関する収入・経費情報
  - レシート・領収書の画像データ

(2) 自動的に収集される情報
  - アクセスログ（IPアドレス、アクセス日時、リファラー）
  - デバイス情報（ブラウザ、OS、画面サイズ）
  - Cookie情報
  - サービスの利用状況

(3) 第三者認証により取得する情報
  - Googleアカウントのメールアドレスおよびプロフィール情報

2. 利用目的
当社は、収集した個人情報を以下の目的で利用します。
(1) 本サービスの提供・運営・維持
(2) レシート画像のOCR読取りおよび経費の自動分類
(3) 副業所得の集計および確定申告要否の判定
(4) ユーザーからのお問い合わせへの対応
(5) サービスの改善および新機能の開発
(6) 利用状況の統計的分析
(7) 有料プランの課金処理
(8) 重要なお知らせの通知（規約変更、サービス停止等）
(9) 不正利用の検知および防止

3. 第三者提供
当社は、以下の場合を除き、個人情報を第三者に提供しません。
(1) ユーザーの同意がある場合
(2) 法令に基づく場合
(3) 以下の業務委託先・連携サービスへの提供

  - Supabase Inc.（データベース・認証基盤、データ保管場所：東京リージョン）
  - Stripe, Inc.（決済処理、所在地：米国）
  - OpenAI, Inc.（AI分析処理、所在地：米国）
  - Vercel Inc.（ホスティング、所在地：米国、CDN東京エッジ）
  - Google LLC（アクセス解析 Google Analytics 4、所在地：米国）

4. 外国にある第三者への提供について
上記のうちStripe、OpenAI、Vercel、Googleは米国に所在する事業者です。
米国における個人情報の保護に関する制度については、個人情報保護委員会の
公表資料をご参照ください。各事業者は以下の体制を整備しています。
  - Stripe：PCI DSS Level 1準拠
  - OpenAI：SOC 2 Type II取得、データ処理契約（DPA）締結済み
  - Vercel：SOC 2 Type II取得
  - Google：ISO 27001認証取得

5. Cookieの使用について
当社は、以下の目的でCookieを使用します。
(1) セッション管理（ログイン状態の維持）
(2) Google Analytics 4によるアクセス解析
(3) サービスの利便性向上

ユーザーはブラウザの設定によりCookieを無効にできますが、本サービスの一部機能が
利用できなくなる場合があります。

Google Analytics 4のオプトアウトについては、以下のGoogleが提供するツールを
ご利用ください。
https://tools.google.com/dlpage/gaoptout

6. 安全管理措置
当社は、個人情報の漏えい、滅失、毀損の防止のために以下の安全管理措置を講じます。
(1) データの暗号化（通信時：TLS 1.3、保存時：AES-256）
(2) アクセス制御（開発者のみがデータベースにアクセス可能）
(3) Supabase の Row Level Security（RLS）によるユーザーデータの分離
(4) 定期的なセキュリティ監査

7. 個人情報の開示・訂正・削除
ユーザーは、当社に対し、自己の個人情報について以下の請求を行うことができます。
(1) 利用目的の通知
(2) 開示
(3) 内容の訂正、追加または削除
(4) 利用の停止または消去
(5) 第三者への提供の停止

請求は以下のお問い合わせ先までご連絡ください。本人確認のうえ、合理的な期間内に対応します。

8. データの保持期間
(1) ユーザーデータ：アカウント削除から30日以内に完全削除
(2) レシート画像：OCR処理完了後90日で自動削除（設定変更可）
(3) アクセスログ：取得から1年間
(4) 決済記録：法令に基づき7年間

9. 本ポリシーの変更
当社は、必要に応じて本ポリシーを変更することがあります。
変更する場合は、本サービス上で通知します。

10. お問い合わせ先
個人情報の取扱いに関するお問い合わせは、以下までご連絡ください。
[運営者名]
メールアドレス：[メールアドレス]
```

---

## Cookie同意バナーの実装

GDPRは現時点では副楽には直接適用されませんが、GA4を使用する場合は
Cookie同意バナーの実装が推奨されます。

```typescript
// components/cookie-consent.tsx の構成イメージ
// - 初回訪問時にバナーを表示
// - 「同意する」ボタンでGA4のCookieを有効化
// - 「拒否する」ボタンでGA4を無効化
// - 同意状況をlocalStorageに保存
// - 同意状況に応じてgtag('consent', 'update', {...}) を呼び出し
```

---

## レシート画像のデータ取扱い

### レシート画像に含まれる個人情報

レシート画像には以下の個人情報・センシティブ情報が含まれる可能性があります：

- 購入者名（クレジットカード利用時）
- カード番号の末尾4桁
- 購入場所（店舗名・住所）
- 購入日時
- 購入品目（医薬品等のセンシティブ情報を含む場合あり）

### 画像データの保存とセキュリティ

**保存場所：**
- Supabase Storage（東京リージョン）に暗号化して保存
- バケットは非公開（Private）に設定
- RLS（Row Level Security）により、アップロードしたユーザーのみアクセス可能

**暗号化：**
- 通信時：TLS 1.3
- 保存時：Supabase Storageのサーバーサイド暗号化（AES-256）
- 画像URLは署名付きURL（Signed URL）で期限付きアクセスを提供

**アクセス制御：**
```sql
-- Supabase Storage のRLSポリシー例
CREATE POLICY "Users can upload own receipts"
ON storage.objects FOR INSERT
WITH CHECK (
  auth.uid()::text = (storage.foldername(name))[1]
);

CREATE POLICY "Users can view own receipts"
ON storage.objects FOR SELECT
USING (
  auth.uid()::text = (storage.foldername(name))[1]
);

CREATE POLICY "Users can delete own receipts"
ON storage.objects FOR DELETE
USING (
  auth.uid()::text = (storage.foldername(name))[1]
);
```

### 保持期間と自動削除

**デフォルトの保持ルール：**
- OCR処理完了後、テキストデータを抽出・保存
- 画像データは90日間保持後、自動削除
- ユーザー設定で保持期間を変更可能（即時削除〜1年間）

**自動削除の実装：**
```typescript
// Supabase Edge Function または cron ジョブで実装
// 1. receipts テーブルから保持期間を超えた画像を検索
// 2. Supabase Storage から画像ファイルを削除
// 3. receipts テーブルの image_url を null に更新
// 4. 削除ログを記録
```

### ユーザーからの削除要求への対応

**削除要求への対応フロー：**
1. ユーザーが設定画面から「データ削除」をリクエスト
2. 本人確認（ログイン済みであることを確認）
3. 削除対象の選択（特定のレシート/全レシート/アカウント全体）
4. 確認画面の表示（削除は取り消せない旨を警告）
5. 削除処理の実行
   - レシート画像の物理削除（Supabase Storage）
   - OCRテキストデータの削除
   - 関連する経費データの削除（ユーザーの選択に応じて）
6. 削除完了の通知メール送信
7. 削除ログの記録（誰が、いつ、何を削除したか）

**アカウント全体の削除（退会）の場合：**
- 全ユーザーデータの削除（30日以内に完全削除）
- Stripe Customerの削除（サブスクリプション解約含む）
- Supabase Auth のユーザー削除
- バックアップからの除外

### AI（OpenAI）への画像送信に関する注意

**OpenAIのデータ利用ポリシー：**
- API経由のデータはモデルの学習には使用されない（2024年3月以降のデフォルト設定）
- ただし、不正利用監視のために一定期間保持される場合がある（最大30日）
- Zero Data Retention（ZDR）オプションの利用を検討

**対応策：**
- プライバシーポリシーにOpenAIへのデータ送信を明記
- 送信前にユーザーの同意を取得
- 必要最小限のデータのみを送信（画像全体ではなくトリミング等の検討）
- OpenAIとのData Processing Agreement（DPA）の締結

---

## 法令チェックリスト（プライバシー関連）

- [ ] 個人情報保護法（APPI）：プライバシーポリシーの整備
- [ ] 電子帳簿保存法：データの保存要件の確認
- [ ] 改正電気通信事業法（2023年6月施行）：外部送信規律への対応（Cookie等）
- [ ] 個人情報の安全管理措置の十分性の確認
